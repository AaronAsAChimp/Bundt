<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
<script src="jquery.bundt.core.js" type="text/javascript"></script>
<style>

.fail .wrong,
.fail .result {
	background: red;
	color: white;
	font-weight: bold;
}

.pass .result {
	background: green;
	color: white;
	font-weight: bold;
}
	
</style>
<script type="text/javascript">
$(document).ready( function() {
	var tests = [
		{ 
			"id": "Identity Transform",
			"matrix":[
				1, 0, 0,
				0, 1, 0,
				0, 0, 1
			],
			"geometry":	[
				{x: 10, y: 0},
				{x: 15, y: 0},
				{x: 20, y: 0},
				{x: 25, y: 0},
				{x: 30, y: 0}
			],
			"expected": [
				{x: 10, y: 0},
				{x: 15, y: 0},
				{x: 20, y: 0},
				{x: 25, y: 0},
				{x: 30, y: 0}
			]
		}, { 
			"id": "Translation Transform",
			"matrix":[
				1, 0, 5,
				0, 1, 5,
				0, 0, 1
			],
			"geometry":	[
				{x: 10, y: 0},
				{x: 15, y: 0},
				{x: 20, y: 0},
				{x: 25, y: 0},
				{x: 30, y: 0}
			],
			"expected": [
				{x: 15, y: 5},
				{x: 20, y: 5},
				{x: 25, y: 5},
				{x: 30, y: 5},
				{x: 35, y: 5}
			]
		}, { 
			"id": "Rotaton Transform",
			"matrix":[
				Math.cos(Math.PI / 2), Math.sin(Math.PI / 2), 0,
				-Math.sin(Math.PI / 2), Math.cos(Math.PI / 2), 0,
				0, 0, 1
			],
			"geometry":	[
				{x: 10, y: 0},
				{x: 15, y: 0},
				{x: 20, y: 0},
				{x: 25, y: 0},
				{x: 30, y: 0}
			],
			"expected": [
				{y: -10, x: 0},
				{y: -15, x: 0},
				{y: -20, x: 0},
				{y: -25, x: 0},
				{y: -30, x: 0}
			]
		}
	];
	
	function test_results(name, geo, pass) {
		$("<tr>")
			.addClass((pass)? "pass" : "fail")
			.append($("<td>").text(name))
			.append($("<td>").append(geo))
			.append($("<td>").addClass("result").text((pass)? "Pass" : "Fail"))
			.appendTo("#test_space tbody")
	}
	
	function get_data (data) {
		var geo = data.data.geometry;
		var geo_out = "[";
		var pass = true;
		
		for(node in geo) {
			console.log(Math.abs(geo[node].x - data.data.expected[node].x) < 1e-14 && Math.abs(geo[node].y - data.data.expected[node].y) < 1e-14)
			if(Math.abs(geo[node].x - data.data.expected[node].x) < 1e-14 && Math.abs(geo[node].y - data.data.expected[node].y) < 1e-14) {
						geo_out += " {x: " + geo[node].x + " y: " + geo[node].y + "} ";
			} else {
				pass = false;
				geo_out += " <span class=\"wrong\">{x: " + geo[node].x + " y: " + geo[node].y + "} </span>";
		
			}
			
		}
		geo_out = $("<div>").html(geo_out + "]");
		
		test_results(data.data.id, geo_out, pass)
	}
	
	function errors (e) {
		test_results(e.filename + " line:" + e.lineno, e.message, false)
	}
	
	for(var i = 0; i < tests.length; i++) {
		var thread = new Worker("bundt.transformer.js");
		
		thread.onmessage = get_data;
		thread.onerror = errors;
		thread.postMessage(tests[i]);
	}
	
				
});
</script>
</head>
<body>
<table id="test_space">
	<thead>
		<tr>
			<th>Test Name</th>
			<th>Output</th>
			<th>Pass / Fail</th>
		</tr>
	</thead>
	<tbody>
		
	</tbody>
</table>
</body>
</html>
